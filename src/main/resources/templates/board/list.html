<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8">
  <title>자유게시판</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <!-- 헤더 CSS -->
  <link rel="stylesheet" th:href="@{/css/layout/header.css}">
  <!-- List Page CSS -->
  <link rel="stylesheet" th:href="@{/css/board/boardlist.css}" />
</head>
<body>
<!-- 상단 헤더 -->
<div th:replace="~{layout/header :: header}"></div>

<div class="container py-4">
  <h3 class="mb-3">게시판</h3>
  <div class="d-flex justify-content-end align-items-center gap-2 mb-3">

    <!-- 전체 글 보기 버튼 -->
    <a class="btn btn-secondary btn-sm me-auto" th:href="@{/board}">전체</a>
    <!--리스트 카드 변환 버튼-->
    <button id="viewToggleBtn" class="btn btn-light border btn-sm">
      <i id="viewToggleIcon" class="bi bi-grid-3x3-gap"></i>
    </button>
    <!-- 검색 폼 -->
    <form th:action="@{/board}" method="get" class="search-form position-relative">
      <input class="form-control search-input"
             name="search"
             type="text"
             placeholder="검색"
             th:value="${search}"/>
      <button type="submit" class="search-btn">
        <i class="bi bi-search"></i>
      </button>
    </form>
    <!-- 글쓰기 버튼 -->
    <a class="btn btn-primary btn-sm" th:href="@{/board/write}">글쓰기</a>
  </div>
  <!-- 글 목록 테이블-->
  <table id="listView" class="table table-hover bg-white rounded shadow-sm table-fixed">
    <thead class="table-light">
    <tr>
      <th class="text-center" style="width: 70px;">번호</th>
      <th class="text-center">제목</th>
      <th class="text-center" style="width: 120px;">작성자</th>
      <th class="text-center" style="width: 130px;">작성일</th>
      <th class="text-center" style="width: 70px;">조회수</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="post, i : ${posts.content}"
        th:onclick="'window.location.href=\'/board/' + ${post.id} + '\';'"
        style="cursor: pointer;">
      <td class="text-center"
          th:text="${#numbers.formatInteger(posts.totalElements - (posts.number * posts.size) - i.index, 0)}"></td>
      <td class="text-start">
        <a th:href="@{'/board/' + ${post.id}}"
           th:text="${post.title}"
           class="text-decoration-none text-dark"></a>
      </td>
      <td class="text-center" th:text="${post.memberName}"></td>
      <td class="text-center" th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd')}"></td>
      <td class="text-center" th:text="${post.count}"></td>
    </tr>
    </tbody>
  </table>
  <!-- 글 목록 카드-->
  <div id="cardView" class="row g-3" style="display:none;">
    <div class="col-md-4" th:each="post : ${posts.content}">
      <a th:href="@{'/board/' + ${post.id}}" class="text-decoration-none">
        <div class="card h-100 shadow-sm list-card p-2">
          <h6 class="post-title" th:text="${post.title}"></h6>
          <div class="post-meta">
            <span th:text="${post.memberName}"></span> ·
            <span th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd')}"></span> ·
            조회 <span th:text="${post.count}"></span>
          </div>
          <p class="post-preview" th:text="${post.content}"></p>
        </div>
      </a>
    </div>
  </div>
  <!-- 페이지네이션 -->
  <nav th:if="${posts.totalPages > 1}" class="mt-4">
    <ul class="pagination justify-content-center">
      <li class="page-item" th:classappend="${posts.first}? 'disabled'">
        <a class="page-link" th:href="@{/board(page=${posts.number - 1}, search=${search})}">이전</a>
      </li>
      <li class="page-item" th:each="i : ${#numbers.sequence(0, posts.totalPages-1)}"
          th:classappend="${i == posts.number}? 'active'">
        <a class="page-link" th:href="@{/board(page=${i}, search=${search})}" th:text="${i+1}">1</a>
      </li>
      <li class="page-item" th:classappend="${posts.last}? 'disabled'">
        <a class="page-link" th:href="@{/board(page=${posts.number + 1}, search=${search})}">다음</a>
      </li>
    </ul>
  </nav>
</div>

<!-- 하단 푸터  -->
<div th:replace="~{layout/footer :: footer}"></div>

<!-- Scripts -->
<script src="/js/common/csrfFetch.js" defer></script>

<script src="/js/layout/header.js" defer></script>
<script>
  const listView = document.getElementById("listView");
  const cardView = document.getElementById("cardView");

  const toggleBtn = document.getElementById("viewToggleBtn");
  const toggleIcon = document.getElementById("viewToggleIcon");

  // 저장된 상태 불러오기 (list / card)
  let currentView = localStorage.getItem("boardView") || "list";

  function applyView(view) {
    if (view === "card") {
      // 카드 보기
      listView.style.display = "none";
      cardView.style.display = "flex";

      // 버튼 아이콘: 리스트보기
      toggleIcon.className = "bi bi-list-ul";

    } else {
      // 리스트 보기
      listView.style.display = "table";
      cardView.style.display = "none";

      // 버튼 아이콘: 카드보기
      toggleIcon.className = "bi bi-grid-3x3-gap";
    }

    currentView = view;
    localStorage.setItem("boardView", view);
  }

  // 버튼 클릭 시 톨글
  toggleBtn.addEventListener("click", () => {
    if (currentView === "list") {
      applyView("card");
    } else {
      applyView("list");
    }
  });

  // 초기 상태 적용
  applyView(currentView)
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" defer></script>
</body>
</html>
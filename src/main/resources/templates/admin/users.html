<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>회원 관리 | NewsTwin</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<th:block th:replace="~{layout/header_admin :: header}"></th:block>

<main class="container py-5">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="fw-semibold">회원 관리</h2>
    <select id="userTypeSelect" class="form-select w-auto"
            onchange="filterBy('userTypeSelect', 'role', '/admin/users')">
      <option value="">전체</option>
      <option value="ROLE_ADMIN" th:selected="${selectedRole == 'ROLE_ADMIN'}">관리자</option>
      <option value="ROLE_USER" th:selected="${selectedRole == 'ROLE_USER'}">사용자</option>
    </select>
  </div>
  <table class="table table-hover align-middle shadow-sm rounded-3 overflow-hidden">
    <thead class="table-light">
      <tr class="text-center">
        <th style="width: 5%;">No</th>
        <th style="width: 10%;">닉네임</th>
        <th style="width: 15%;">이메일</th>
        <th style="width: 30%;">구독분야</th>
        <th style="width: 10%;">이메일인증상태</th>
        <th style="width: 10%;">메일상태</th>
        <th style="width: 10%;">구독상태</th>
        <th style="width: 10%;">상태</th>
      </tr>
    </thead>
    <tbody class="text-center">
      <tr th:each="member, stat : ${members}">
        <td th:text="${stat.count}"></td>
        <td th:text="${member.memberName}"></td>
        <td th:text="${member.email}"></td>
        <td th:text="${#strings.arrayJoin(member.categories, ', ')}"></td>
        <td>
          <span class="badge px-3 py-2"
                th:classappend="${member.isVerified != null && member.isVerified} ? ' bg-success' : ' bg-secondary'"
                th:text="${member.isVerified != null && member.isVerified ? '인증' : '미인증'}">
          </span>
        </td>

        <td>
          <span class="badge px-3 py-2 cursor-pointer"
                th:classappend="${member.receiveEmail != null && member.receiveEmail} ? ' bg-success' : ' bg-secondary'"
                th:text="${member.receiveEmail != null && member.receiveEmail ? '수신' : '거부'}"
                th:attr="data-user-id=${member.id}"
                onclick="toggleStatus(this, 'receiveEmail')">
          </span>
        </td>

        <td>
          <span class="badge px-3 py-2 cursor-pointer"
                th:classappend="${member.subscriptionStatus == '구독중'} ? ' bg-success' : ' bg-secondary'"
                th:text="${member.subscriptionStatus}"
                th:attr="data-user-id=${member.id},
                         data-category-ids=${#strings.arrayJoin(member.categoryIds, ',')}"
                onclick="toggleStatus(this, 'subscription')">
          </span>
        </td>

        <td>
          <span class="badge px-3 py-2 cursor-pointer"
                th:classappend="${member.isActive} ? ' bg-success' : ' bg-danger'"
                th:text="${member.isActive ? '활성' : '비활성'}"
                th:attr="data-user-id=${member.id}"
                onclick="toggleStatus(this, 'member')">
          </span>
        </td>
      </tr>
    </tbody>
  </table>
  <th:block th:replace="~{layout/pagination :: pagination(${page}, '/admin/users')}"></th:block>
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" defer></script>
<script src="../js/admin/dashboard.js"></script>

<th:block th:replace="layout/footer :: footer"></th:block>
</body>
</html>

<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>회원 관리 | NewsTwin</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<th:block th:replace="layout/header_admin :: header"></th:block>

<main class="container py-5">
  <h2 class="fw-semibold mb-4">회원 관리</h2>
  <table class="table table-hover align-middle shadow-sm rounded-3 overflow-hidden">
    <thead class="table-light">
      <tr class="text-center">
        <th style="width: 5%;">No</th>
        <th style="width: 10%;">닉네임</th>
        <th style="width: 15%;">이메일</th>
        <th style="width: 30%;">구독분야</th>
        <th style="width: 10%;">구독상태</th>
        <th style="width: 10%;">상태</th>
      </tr>
    </thead>
    <tbody class="text-center">
      <tr th:each="member, stat : ${members}">
        <td th:text="${stat.count}"></td>
        <td th:text="${member.memberName}"></td>
        <td th:text="${member.email}"></td>
        <td th:text="${#strings.arrayJoin(member.categories, ', ')}"></td>

        <td>
          <span class="badge px-3 py-2 cursor-pointer"
                th:classappend="${member.subscriptionStatus == '구독중'} ? ' bg-success' : ' bg-secondary'"
                th:text="${member.subscriptionStatus}"
                th:attr="data-user-id=${member.id},
                         data-category-id=${#lists.isEmpty(member.categoryIds) ? 0 : member.categoryIds[0]}"
                onclick="toggleStatus(this, 'subscription')">
          </span>
        </td>

        <td>
          <span class="badge px-3 py-2 cursor-pointer"
                th:classappend="${member.isActive} ? ' bg-success' : ' bg-danger'"
                th:text="${member.isActive ? '활성' : '비활성'}"
                th:attr="data-user-id=${member.id}"
                onclick="toggleStatus(this, 'member')">
          </span>
        </td>
      </tr>
    </tbody>
  </table>
  <!-- 게시글 테이블 아래에 페이징 추가 -->
  <nav aria-label="Page navigation example">
    <ul class="pagination justify-content-center mt-4">
      <li class="page-item disabled">
        <a class="page-link" href="#" tabindex="-1">이전</a>
      </li>
      <li class="page-item active"><a class="page-link" href="#">1</a></li>
      <li class="page-item"><a class="page-link" href="#">2</a></li>
      <li class="page-item"><a class="page-link" href="#">3</a></li>
      <li class="page-item">
        <a class="page-link" href="#">다음</a>
      </li>
    </ul>
  </nav>
</main>

<!-- 모달 -->
<div class="modal fade" id="statusModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow-sm rounded-3">
      <div class="modal-header border-0 pb-0">
        <h5 class="modal-title fw-semibold">회원상태 변경</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p id="statusModalText" class="mb-0 text-secondary">상태를 변경하시겠습니까?</p>
      </div>
      <div class="modal-footer border-0 pt-0">
        <button type="button" class="btn btn-dark px-4" data-bs-dismiss="modal">아니요</button>
        <button type="button" class="btn btn-outline-dark px-4" id="confirmStatusBtn">예</button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" defer></script>
<script src="../js/admin/dashboard.js"></script>

<th:block th:replace="layout/footer :: footer"></th:block>
</body>
</html>

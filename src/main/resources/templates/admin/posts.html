<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>게시글 관리 | NewsTwin</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<th:block th:replace="~{layout/header_admin :: header}"></th:block>

<main class="container py-5">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="fw-semibold">게시글 관리</h2>
    <select id="postTypeSelect" class="form-select w-auto"
            onchange="filterBy('postTypeSelect', 'type', '/admin/posts')">
      <option value="">전체</option>
      <option value="news" th:selected="${selectedType == 'news'}">뉴스</option>
      <option value="community" th:selected="${selectedType == 'community'}">커뮤니티</option>
    </select>
  </div>
  <table class="table table-hover align-middle shadow-sm rounded-3 overflow-hidden">
    <thead class="table-light">
      <tr class="text-center">
        <th style="width: 5%;">No</th>
        <th style="width: 10%;">닉네임</th>
        <th style="width: 10%;">카테고리</th>
        <th style="width: 30%;">제목</th>
        <th style="width: 10%;">작성일</th>
        <th style="width: 5%;">상태</th>
      </tr>
    </thead>
    <tbody class="text-center" id="postTableBody" th:fragment="postTableBody">
      <tr th:each="post, stat : ${posts}">
        <td th:text="${stat.count}"></td>
        <td th:text="${post.memberName}"></td>
        <td th:text="${post.categories != null && !post.categories.isEmpty()
              ? #strings.arrayJoin(post.categories, ', ')
              : '-'}"></td>
        <td>
          <a th:href="@{'/admin/posts-contents/' + ${post.id}}"
             th:text="${post.title}"
             class="text-decoration-none text-dark cursor-pointer">
          </a>
        </td>
        <td th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd HH:mm')}"></td>
        <td>
          <span class="badge px-3 py-2 cursor-pointer"
                th:classappend="${post.isActive} ? ' bg-success' : ' bg-danger'"
                th:text="${post.isActive ? '활성' : '비활성'}"
                th:attr="data-post-id=${post.id}"
                onclick="postToggleStatus(this, 'post')">
          </span>
        </td>
      </tr>
    </tbody>
  </table>
  <th:block th:replace="~{layout/pagination :: pagination(${page}, '/admin/posts')}"></th:block>
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" defer></script>
<script src="../js/admin/dashboard.js"></script>

<th:block th:replace="layout/footer :: footer"></th:block>
</body>
</html>

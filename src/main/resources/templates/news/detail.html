<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title th:text="${post.title}">NewsTwin</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
  <!-- Header CSS -->
  <link rel="stylesheet" th:href="@{/css/layout/header.css}">
  <!-- Post Detail CSS -->
  <link rel="stylesheet" th:href="@{/css/news/postdetail.css}">
</head>

<body>
<!-- ìƒë‹¨ ë„¤ë¹„ -->
<div th:replace="~{layout/header :: header}"></div>

<div class="container-fluid">
  <div class="row">
    <!-- ì‚¬ì´ë“œë°” -->
    <div th:replace="~{layout/sidebar :: sidebar}"></div>

    <!-- ë³¸ë¬¸ -->
    <main class="col-9 py-4 position-relative">

      <!-- ê³ ì • ì‚¬ì´ë“œ ì•¡ì…˜ë°” -->
      <div class="side-action">
        <button class="action-btn position-relative" id="sideLike" title="ì¢‹ì•„ìš”">
          <span class="emoji">ğŸ¤</span>
          <span id="sideLikeCount"
                class="badge bg-secondary position-absolute top-0 start-100 translate-middle rounded-pill small">
            0
          </span>
        </button>

        <button class="action-btn position-relative" id="sideComment" title="ëŒ“ê¸€">
          <i class="bi bi-chat"></i>
          <span id="sideCommentCount"
                class="badge bg-secondary position-absolute top-0 start-100 translate-middle rounded-pill small">
            0
          </span>
        </button>

        <button class="action-btn" id="sideBookmark" title="ë¶ë§ˆí¬">
          <i class="bi bi-bookmark"></i>
        </button>

        <div class="dropdown">
          <button class="action-btn" id="sideShare" data-bs-toggle="dropdown" aria-expanded="false" title="ê³µìœ ">
            <i class="bi bi-share"></i>
          </button>
          <ul class="dropdown-menu shadow-sm">
            <li><a class="dropdown-item share-copy" href="#">ğŸ”— URL ë³µì‚¬</a></li>
            <li><a class="dropdown-item share-sns" href="#">ğŸ“¢ SNS ê³µìœ </a></li>
          </ul>
        </div>
      </div>

      <!-- ë³¸ë¬¸ ë‚´ìš© -->
      <div class="content-wrap">

        <h1 class="post-title" id="markdownTitle"></h1>

        <div class="post-meta mb-2">
          <span th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd HH:mm')}"></span>
          <span th:if="${post.categoryName != null}">
            Â· <span th:text="${post.categoryName}"></span>
          </span>
          Â· ì¡°íšŒìˆ˜ <span th:text="${post.count}"></span>
        </div>

        <!-- ë§ˆí¬ë‹¤ìš´ ì˜ì—­ -->
        <div class="post-body"></div>

        <!-- í•˜ë‹¨ ë²„íŠ¼ -->
        <div class="reaction-bar">
          <button id="likeBtn" class="btn btn-light border-0 d-flex align-items-center gap-1"
                  th:data-post-id="${post.id}" th:data-liked="${liked}">
            <span id="heartIcon" th:text="${liked} ? 'â¤ï¸' : 'ğŸ¤'"></span>
            <span id="likeCount" th:text="${likeCount}"></span>
            <span>ì¢‹ì•„ìš”</span>
          </button>

          <button id="bookmarkBtn" class="btn btn-light border-0 d-flex align-items-center gap-1"
                  th:data-post-id="${post.id}" th:data-bookmarked="${bookmarked}">
            <i id="bookmarkIcon" th:class="${bookmarked} ? 'bi bi-bookmark-fill' : 'bi bi-bookmark'"></i>
            <span>ë¶ë§ˆí¬</span>
          </button>

          <button id="shareBtn"
                  class="btn btn-light border-0 d-flex align-items-center gap-1">
            <i class="bi bi-share"></i>
            <span>ê³µìœ í•˜ê¸°</span>
          </button>

          <!-- ë³¸ë¬¸ í•˜ë‹¨ ê³µìœ  ë©”ë‰´ -->
          <div id="shareMenu" class="card d-none">
            <ul class="list-group list-group-flush">
              <li class="list-group-item share-copy">ğŸ”— URL ë³µì‚¬</li>
              <li class="list-group-item share-sns">ğŸ“¢ SNS ê³µìœ </li>
            </ul>
          </div>

        </div>

        <!-- ëŒ“ê¸€ -->
        <div class="comment-section mt-4">
          <h6 class="fw-semibold">ëŒ“ê¸€ <span id="commentTotal"></span></h6>

          <!-- ì‘ì„±í¼ -->
          <div class="comment-input-area mb-3">
            <div class="d-flex align-items-start gap-2">
              <img th:src="${loginUser != null && loginUser.profileImage != null ? loginUser.profileImage : '/images/basic-profile.png'}"
                   class="rounded-circle" style="width:36px;height:36px;object-fit:cover;">
              <textarea id="commentInput" rows="3" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
            </div>
            <div class="d-flex justify-content-end mt-2">
              <button id="commentSubmit" class="comment-submit">ë“±ë¡</button>
            </div>
          </div>

          <!-- ëª©ë¡ -->
          <ul id="commentList" class="list-unstyled"></ul>
          <!-- ë¬´í•œìŠ¤í¬ë¡¤ sentinel -->
          <div id="commentSentinel" class="py-3 text-center text-secondary small">ë” ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>
        </div>
      </div>
    </main>
  </div>
</div>

<!-- Footer -->
<div th:replace="~{layout/footer :: footer}"></div>

<!-- JS ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<!-- ê³µí†µ JS -->
<script src="/js/layout/header.js" defer></script>
<script src="/js/subscription.js" defer></script>
<script src="/js/comments.js" defer></script>
<script src="/js/postdetail.js" defer></script>

<!-- ì „ì—­ ìƒíƒœ (subscription.jsì—ì„œ ì‚¬ìš©) -->
<script th:inline="javascript">
  const MEMBER_RECEIVE_EMAIL = [[${memberReceiveEmail}]];
  const IS_LOGGED_IN = [[${isLoggedIn}]];
  window.LOGIN_PROFILE_URL = /*[[${loginUser != null ? loginUser.profileImage : null}]]*/ null;
  window.DEFAULT_PROFILE_URL = '/images/basic-profile.png';
</script>

<!-- ë§ˆí¬ë‹¤ìš´ ë Œë”ë§ -->
<script th:inline="javascript">
  document.addEventListener("DOMContentLoaded", () => {

    const rawTitle = /*[[${post.title}]]*/ "";
    const rawMarkdown = /*[[${post.content}]]*/ "";

    const titleElement = document.getElementById("markdownTitle");
    if (rawTitle) {
      titleElement.innerHTML = marked.parseInline(rawTitle);
    }

    const contentElement = document.querySelector(".post-body");
    if (rawMarkdown) {
      contentElement.innerHTML = marked.parse(rawMarkdown);
    }
  });
</script>

</body>
</html>

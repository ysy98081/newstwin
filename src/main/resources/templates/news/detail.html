<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title th:text="${post.title}">NewsTwin</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Bootstrap Icons (â¤ï¸, ğŸ“˜ ë“± ì•„ì´ì½˜ìš©) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />

  <style>
    body { background-color:#f8f9fa; }
    .content-wrap { max-width: 720px; margin: auto; background: white; border-radius: .5rem; padding: 2rem; box-shadow: 0 0.2rem 1rem rgba(0,0,0,.05); }
    .post-title { font-weight:700; font-size:1.6rem; line-height:1.4; }
    .post-meta { color:#6c757d; font-size:.9rem; }
    .post-image img { width:100%; border-radius:.5rem; margin:1rem 0; }
    .post-body { white-space:pre-line; font-size:1rem; color:#333; line-height:1.7; }
    .reaction-bar { display:flex; align-items:center; gap:1.2rem; margin-top:1.5rem; }
    .reaction-bar button { background:none; border:none; color:#6c757d; cursor:pointer; display:flex; align-items:center; gap:0.4rem; }
    .reaction-bar button:hover { color:#dc3545; }
    .comment-section { margin-top:2rem; }
  </style>
</head>
<body>

<!-- ìƒë‹¨ ë„¤ë¹„ -->
<nav class="navbar navbar-light bg-white border-bottom sticky-top px-3">
  <a class="navbar-brand fw-bold" href="/" style="font-size:1.2rem;">NewsTwin</a>
  <div>
    <a class="btn btn-outline-secondary btn-sm" th:href="@{/feed}">ëª©ë¡ìœ¼ë¡œ</a>
  </div>
</nav>

<!-- ë³¸ë¬¸ -->
<main class="py-4">
  <div class="content-wrap">
    <!-- ì œëª© -->
    <h1 class="post-title" th:text="${post.title}">ì œëª©</h1>

    <!-- ë©”íƒ€ì •ë³´ -->
    <div class="post-meta mb-2">
      <span th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd HH:mm')}">2025-10-31</span>
      <span th:if="${post.categoryName != null}">
        Â· <span th:text="${post.categoryName}">ì¹´í…Œê³ ë¦¬</span>
      </span>
       ì¡°íšŒìˆ˜ <span th:text="${post.count}"></span>
    </div>

    <!-- ì¸ë„¤ì¼ -->
    <div class="post-image" th:if="${post.thumbnailUrl != null}">
      <img th:src="${post.thumbnailUrl}" alt="thumbnail">
    </div>

    <!-- ë³¸ë¬¸ -->
    <div class="post-body" th:utext="${post.content}"></div>

    <!-- ë°˜ì‘ ë²„íŠ¼ -->
    <div class="reaction-bar">

      <button id="likeBtn"
              class="btn btn-light border-0 d-flex align-items-center gap-1"
              th:data-post-id="${post.id}"
              th:data-liked="${liked}">
        <span id="heartIcon" th:text="${liked} ? 'â¤ï¸' : 'ğŸ¤'"></span>
        <span id="likeCount" th:text="${likeCount}">0</span>
        <span>ì¢‹ì•„ìš”</span>
      </button>

      <button id="bookmarkBtn"
              class="btn btn-light border-0 d-flex align-items-center gap-1"
              th:data-post-id="${post.id}"
              th:data-bookmarked="${bookmarked}">
        <i id="bookmarkIcon"
           th:class="${bookmarked} ? 'bi bi-bookmark-fill' : 'bi bi-bookmark'"></i>
        <span>ë¶ë§ˆí¬</span>
      </button>
    </div>

    <!-- ëŒ“ê¸€ -->
    <div class="comment-section">
      <h6 class="fw-semibold">
      </h6>
      <div class="border-top mt-2 pt-3 text-secondary small">
        ì•„ì§ ëŒ“ê¸€ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.
      </div>
    </div>

  </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  const likeBtn = document.getElementById('likeBtn');
  const heartIcon = document.getElementById('heartIcon');
  const likeCountEl = document.getElementById('likeCount');
  const postId = likeBtn.dataset.postId;

  const bookmarkBtn = document.getElementById('bookmarkBtn');
  const bookmarkIcon = document.getElementById('bookmarkIcon');


  document.addEventListener("DOMContentLoaded", async () => {
    const resLike = await fetch(`/api/posts/${postId}/like`);
    if (resLike.ok) {
      const { liked, likeCount } = await resLike.json();
      heartIcon.textContent = liked ? 'â¤ï¸' : 'ğŸ¤';
      likeCountEl.textContent = likeCount;
      likeBtn.dataset.liked = liked;
    }

    const resBookmark = await fetch(`/api/posts/${postId}/bookmark`);
    if (resBookmark.ok) {
      const { bookmarked } = await resBookmark.json();
      bookmarkIcon.className = bookmarked ? 'bi bi-bookmark-fill' : 'bi bi-bookmark';
      bookmarkBtn.dataset.bookmarked = bookmarked;
    }
  });

  likeBtn.addEventListener('click', async () => {
    const postId = likeBtn.dataset.postId;
    likeBtn.disabled = true;
    try {
      const res = await fetch(`/api/posts/${postId}/like`, { method: 'POST' });
      if (!res.ok) throw new Error('ì¢‹ì•„ìš” ì‹¤íŒ¨');
      const { liked, likeCount } = await res.json();
      heartIcon.textContent = liked ? 'â¤ï¸' : 'ğŸ¤';
      likeCountEl.textContent = likeCount;
      likeBtn.dataset.liked = liked;
    } catch (e) {
      alert(e.message);
    } finally {
      likeBtn.disabled = false;
    }
  });

  bookmarkBtn.addEventListener('click', async () => {
    bookmarkBtn.disabled = true;
    try {
      const res = await fetch(`/api/posts/${postId}/bookmark`, { method: 'POST' });
      if (!res.ok) throw new Error('ë¶ë§ˆí¬ ì‹¤íŒ¨');
      const { bookmarked } = await res.json();
      bookmarkIcon.className = bookmarked ? 'bi bi-bookmark-fill' : 'bi bi-bookmark';
      bookmarkBtn.dataset.bookmarked = bookmarked;
    } catch (e) {
      alert(e.message);
    } finally {
      bookmarkBtn.disabled = false;
    }
  });
</script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('[data-bs-toggle="tooltip"]')
    .forEach(el => new bootstrap.Tooltip(el));
  });
</script>
</body>
</html>
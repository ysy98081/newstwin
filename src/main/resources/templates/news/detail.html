<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title th:text="${post.title}">NewsTwin</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
  <link rel="stylesheet" th:href="@{/css/layout/header.css}">

  <style>
    body { background-color:#f8f9fa; }
    .content-wrap {
      max-width: 720px;
      margin: auto;
      background: white;
      border-radius: .5rem;
      padding: 1.25rem;
      box-shadow: 0 0.2rem 1rem rgba(0,0,0,.05);
    }
    .post-title { font-weight:700; font-size:1.6rem; line-height:1.4; }
    .post-meta { color:#6c757d; font-size:.9rem; }
    .post-image img { width:100%; border-radius:.5rem; margin:1rem 0; }

    /* ë§ˆí¬ë‹¤ìš´ ë³¸ë¬¸ */
    .post-body { font-size:1rem; color:#333; line-height:1.7; }
    .post-body h1, .post-body h2, .post-body h3 {
      margin-top: 1.4rem; font-weight:700;
    }
    .post-body p, .post-body li {
      line-height:1.7; margin-bottom:0.75rem;
    }
    .post-body code {
      background:#f8f9fa; padding:0.2rem 0.4rem;
      border-radius:4px; font-family:monospace;
    }
    .post-body pre {
      background:#f8f9fa; padding:1rem;
      border-radius:8px; overflow-x:auto;
    }
    .post-body a {
      color:#0d6efd; text-decoration:none;
    }
    .post-body a:hover {
      text-decoration:underline;
    }

    /* íˆ´íŒ ë‹¨ì–´ (ìš©ì–´ ê°•ì¡°ìš©) */
    .nt-term {
      background: linear-gradient(to top, rgba(255, 235, 59, 0.4) 45%, transparent 45%);
      color: #212529;
      font-weight: 500;
      cursor: help;
      position: relative;
      border-radius: 2px;
      transition: background 0.2s ease, color 0.2s ease;
      padding: 0 2px;
    }

    .nt-term:hover {
      background: linear-gradient(to top, rgba(255, 235, 59, 0.7) 45%, transparent 45%);
      color: #000;
    }

    /* â“ ì•„ì´ì½˜ ìŠ¤íƒ€ì¼ (ì¡°ìš©íˆ ê°•ì¡°) */
    .term-icon {
      font-size: 0.75rem;
      color: #adb5bd;
      margin-left: 2px;
      vertical-align: super;
      opacity: 0.7;
      transition: color 0.2s ease, opacity 0.2s ease;
    }

    .nt-term:hover .term-icon {
      color: #212529;
      opacity: 1;
    }


    .reaction-bar { display:flex; align-items:center; gap:1.2rem; margin-top:1.5rem; }
    .reaction-bar button { background:none; border:none; color:#6c757d; cursor:pointer; display:flex; align-items:center; gap:0.4rem; }
    .reaction-bar button:hover { color:#dc3545; }
    .comment-section { margin-top:2rem; }
  </style>
</head>

<body>
<!-- ìƒë‹¨ ë„¤ë¹„ -->
<div th:replace="~{layout/header :: header}"></div>

<div class="container-fluid">
  <div class="row">
    <!-- ì‚¬ì´ë“œë°” -->
    <div th:replace="~{layout/sidebar :: sidebar}"></div>

    <!-- ë³¸ë¬¸ -->
    <main class="col-12 col-md-8 col-lg-7 py-4">
      <div class="content-wrap">
        <!-- ì œëª© -->
        <h1 class="post-title" id="markdownTitle"></h1>

        <!-- ë©”íƒ€ì •ë³´ -->
        <div class="post-meta mb-2">
          <span th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd HH:mm')}">2025-10-31</span>
          <span th:if="${post.categoryName != null}">
            Â· <span th:text="${post.categoryName}">ì¹´í…Œê³ ë¦¬</span>
          </span>
          ì¡°íšŒìˆ˜ <span th:text="${post.count}"></span>
        </div>

        <!-- ì¸ë„¤ì¼ -->
        <div class="post-image" th:if="${post.thumbnailUrl != null}">
          <img th:src="${post.thumbnailUrl}" alt="thumbnail">
        </div>

        <!-- ë³¸ë¬¸ (ë§ˆí¬ë‹¤ìš´ ë Œë”ë§ ëŒ€ìƒ) -->
        <div class="post-body"></div>

        <!-- ë°˜ì‘ ë²„íŠ¼ -->
        <div class="reaction-bar">
          <button id="likeBtn"
                  class="btn btn-light border-0 d-flex align-items-center gap-1"
                  th:data-post-id="${post.id}"
                  th:data-liked="${liked}">
            <span id="heartIcon" th:text="${liked} ? 'â¤ï¸' : 'ğŸ¤'"></span>
            <span id="likeCount" th:text="${likeCount}">0</span>
            <span>ì¢‹ì•„ìš”</span>
          </button>

          <button id="bookmarkBtn"
                  class="btn btn-light border-0 d-flex align-items-center gap-1"
                  th:data-post-id="${post.id}"
                  th:data-bookmarked="${bookmarked}">
            <i id="bookmarkIcon"
               th:class="${bookmarked} ? 'bi bi-bookmark-fill' : 'bi bi-bookmark'"></i>
            <span>ë¶ë§ˆí¬</span>
          </button>

          <button id="shareBtn"
                  class="btn btn-light border-0 d-flex align-items-center gap-1">
            <i class="bi bi-share"></i>
            <span>ê³µìœ í•˜ê¸°</span>
          </button>

          <div id="shareMenu" class="card position-absolute d-none" style="z-index:1000; width:160px;">
            <ul class="list-group list-group-flush">
              <li class="list-group-item share-copy">ğŸ”— URL ë³µì‚¬</li>
              <li class="list-group-item share-sns">ğŸ“¢ SNS ê³µìœ </li>
            </ul>
          </div>

        </div>

        <!-- ëŒ“ê¸€ -->
        <div class="comment-section mt-4">
          <h6 class="fw-semibold">ëŒ“ê¸€<span id="commentTotal"></span></h6>

          <!-- ì‘ì„±í¼ -->
          <div class="mb-3">
            <div class="d-flex align-items-start">
              <img th:src="${loginUser != null && loginUser.profileImage != null ? loginUser.profileImage : '/images/basic-profile.png'}"
                   class="rounded-circle me-2"
                   style="width:32px;height:32px;object-fit:cover;">
              <textarea id="commentInput" class="form-control" rows="3" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
            </div>

            <div class="d-flex justify-content-end mt-2">
              <button id="commentSubmit" class="btn btn-primary btn-sm">ë“±ë¡</button>
            </div>
          </div>

          <!-- ëª©ë¡ -->
          <ul id="commentList" class="list-unstyled"></ul>

          <!-- ë¬´í•œìŠ¤í¬ë¡¤ sentinel -->
          <div id="commentSentinel" class="py-3 text-center text-secondary small">ë” ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>
        </div>
      </div>
    </main>
  </div>
</div>

<!-- í•˜ë‹¨ -->
<div th:replace="~{layout/footer :: footer}"></div>

<!-- Scripts -->
<script th:inline="javascript">
  const IS_LOGGED_IN = [[${isLoggedIn}]];
  const MEMBER_RECEIVE_EMAIL = [[${memberReceiveEmail}]];
  const LOGIN_PROFILE_URL = [[${loginUser != null ? loginUser.profileUrl : null}]];
  const DEFAULT_PROFILE_URL = '/images/basic-profile.png';
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="/js/layout/header.js" defer></script>
<script src="/js/subscription.js" defer></script>
<script src="/js/comments.js" defer></script>
<script src="/js/share.js" defer></script>
<script src="/js/postdetail.js" defer></script>

<!-- ë§ˆí¬ë‹¤ìš´ ë Œë”ë§ -->
<script th:inline="javascript">
  document.addEventListener("DOMContentLoaded", () => {
    const rawTitle = `[[${post.title}]]`;
    const rawMarkdown = `[[${post.content}]]`;

    // ì œëª©ë„ ë§ˆí¬ë‹¤ìš´ ì ìš©
    const titleElement = document.getElementById("markdownTitle");
    if (titleElement && rawTitle) {
      titleElement.innerHTML = marked.parseInline(rawTitle);
    }

    // ë³¸ë¬¸ë„ ë§ˆí¬ë‹¤ìš´ ì ìš©
    const contentElement = document.querySelector(".post-body");
    if (contentElement && rawMarkdown) {
      contentElement.innerHTML = marked.parse(rawMarkdown);
    }

    // íˆ´íŒ í™œì„±í™”
    const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]');
    tooltipTriggerList.forEach(el => new bootstrap.Tooltip(el));
  });
</script>
</body>
</html>

<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      lang="ko">
<head>
    <meta charset="UTF-8">
    <title>회원정보 수정 | NewsTwin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- 공통 헤더 CSS -->
    <link rel="stylesheet" th:href="@{/css/layout/header.css}">
    <!-- 마이페이지 전용 CSS -->
    <link rel="stylesheet" th:href="@{/css/mypage/edit.css}">

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" defer></script>
</head>
<body>
<th:block th:replace="~{layout/header :: header}"></th:block>

<main class="container py-5" style="max-width:720px;">
    <h2 class="fw-semibold mb-4 text-center">회원 정보 수정</h2>

    <!-- ✅ method는 반드시 POST -->
    <form id="updateForm" enctype="multipart/form-data">

        <!-- 프로필 이미지 -->
        <div class="text-center mb-4">
            <div class="position-relative d-inline-block">
                <img id="profilePreview" th:src="${member.profileImage}" alt="프로필 사진"
                     class="rounded-circle border profile-img">
                <label for="profileImage" class="btn btn-sm btn-light border position-absolute bottom-0 end-0">
                    <i class="bi bi-camera"></i> 변경
                </label>
            </div>
            <input type="file" id="profileImage" name="profileImage" class="d-none" accept="image/*">
        </div>

        <!-- 닉네임 -->
        <div class="mb-3">
            <label class="form-label">닉네임</label>
            <input type="text" id="memberName" name="memberName"
                   th:value="${member.memberName}"
                   class="form-control">
        </div>

        <!-- 비밀번호 -->
        <div class="mb-3">
            <label class="form-label">새 비밀번호</label>
            <input type="password" id="password" name="password"
                   class="form-control" placeholder="8~20자 영문+숫자">
        </div>

        <!-- 비밀번호 확인 -->
        <div class="mb-3">
            <label class="form-label">비밀번호 확인</label>
            <input type="password" id="passwordConfirm" class="form-control" placeholder="비밀번호 확인">
            <div id="passwordMatchMessage" class="form-text text-danger d-none">비밀번호가 일치하지 않습니다.</div>
        </div>

        <!-- 이메일 수신 여부 -->
        <div class="mb-3">
            <label class="form-label d-block">이메일 수신 여부</label>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="receiveEmail" id="receiveTrue" value="true"
                       th:checked="${member.receiveEmail == true}">
                <label class="form-check-label" for="receiveTrue">수신함</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="receiveEmail" id="receiveFalse" value="false"
                       th:checked="${member.receiveEmail == false}">
                <label class="form-check-label" for="receiveFalse">수신안함</label>
            </div>
        </div>

        <!-- 구독 카테고리 -->
        <div id="categorySection" class="mb-4">
            <label class="form-label d-block">구독 카테고리 선택</label>
            <div class="row row-cols-2">
                <div class="form-check col" th:each="category : ${categories}">
                    <input class="form-check-input"
                           type="checkbox"
                           th:id="'cat' + ${category.id}"
                           th:value="${category.id}">
                    <label class="form-check-label" th:for="'cat' + ${category.id}"
                           th:text="${category.categoryName}"></label>
                </div>
            </div>
        </div>

        <button type="submit" class="btn btn-primary w-100">정보 수정 완료</button>
    </form>
</main>

<th:block th:replace="~{layout/footer :: footer}"></th:block>

<!-- 외부 JS 분리 -->
<script src="/js/layout/header.js" defer></script>
<script th:src="@{/js/mypage/edit.js}" defer></script>
</body>
</html>

<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      lang="ko">

<head>
    <meta charset="UTF-8">
    <title>회원 탈퇴 | NewsTwin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- 공통 헤더 -->
    <link rel="stylesheet" th:href="@{/css/layout/header.css}">
    <!-- 마이페이지 전용 스타일 (edit.css 그대로 활용) -->
    <link rel="stylesheet" th:href="@{/css/mypage/edit.css}">

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" defer></script>
</head>

<body>
<th:block th:replace="~{layout/header :: header}"></th:block>

<main class="mypage-container container-fluid py-5">
    <div class="row justify-content-center gx-5">

        <!-- 사이드 메뉴 -->
        <aside class="col-lg-3 col-md-4 mb-4 mb-md-0">
            <div class="list-group shadow-sm border-0 rounded-3">
                <a th:href="@{/mypage/edit}" class="list-group-item list-group-item-action">회원 정보 수정</a>
                <a th:href="@{/mypage/subscription}" class="list-group-item list-group-item-action">구독 카테고리 설정</a>
                <a th:href="@{/mypage/bookmarks}" class="list-group-item list-group-item-action">북마크한 뉴스</a>
                <a th:href="@{/mypage/withdraw}" class="list-group-item list-group-item-action active text-danger">회원 탈퇴</a>
            </div>
        </aside>

        <!-- 탈퇴 카드 영역 -->
        <section class="col-lg-8 col-md-8">
            <div class="card border-0 shadow-sm rounded-4 p-5 text-center">
                <h3 class="fw-semibold mb-3 text-danger">회원 탈퇴</h3>
                <p class="text-muted mb-4">
                    정말로 탈퇴하시겠습니까?<br>
                    탈퇴 후에는 계정 및 개인 데이터가 영구적으로 삭제되며 복구가 불가능합니다.
                </p>

                <div class="alert alert-light border-danger small py-2 mb-4">
                    탈퇴 시 저장된 북마크, 구독 내역, 프로필 정보가 모두 삭제됩니다.
                </div>

                <form id="withdrawForm" method="post">
                    <button type="submit" class="btn btn-danger w-100 py-2 rounded-3 fw-semibold">
                        탈퇴하기
                    </button>
                </form>
            </div>
        </section>
    </div>
</main>

<th:block th:replace="~{layout/footer :: footer}"></th:block>

<script src="/js/layout/header.js" defer></script>

<!-- 탈퇴 요청 JS -->
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const form = document.getElementById("withdrawForm");
        if (form) {
            form.addEventListener("submit", async (e) => {
                e.preventDefault();

                if (!confirm("정말 탈퇴하시겠습니까? 복구할 수 없습니다.")) return;

                try {
                    const res = await fetch("/api/mypage/withdraw", { method: "POST" });
                    if (res.ok) {
                        alert("회원 탈퇴가 완료되었습니다.");
                        window.location.href = "/";
                    } else {
                        const msg = await res.text();
                        alert("탈퇴 중 오류 발생: " + msg);
                    }
                } catch (err) {
                    console.error(err);
                    alert("서버 오류가 발생했습니다.");
                }
            });
        }
    });
</script>
</body>
</html>

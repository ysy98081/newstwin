<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title th:text="${title}">이메일 인증</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        body { background:#f8f9fa; }
        .card { max-width: 520px; margin: 10vh auto; border:0; border-radius: 16px; }
        .ok { font-size: 48px; }
    </style>
</head>
<body>
<main class="container">
    <div class="card shadow p-4 text-center">
        <div th:if="${success}">
            <div class="ok mb-2">✅</div>
            <h3 class="mb-2" th:text="${title}">이메일 인증 완료</h3>
            <p class="text-muted mb-4" th:text="${message}">이메일 인증이 완료되었습니다. 로그인해주세요.</p>
            <a href="/login" class="btn btn-dark w-100 fw-semibold">로그인하러 가기</a>
            <p class="text-secondary small mt-3" th:if="${redirectSeconds > 0}">
                <span th:text="${redirectSeconds}">5</span>초 후 자동으로 이동합니다.
            </p>
        </div>

        <div th:if="${!success}">
            <div class="ok mb-2">❌</div>
            <h3 class="mb-2" th:text="${title}">이메일 인증 실패</h3>
            <p class="text-muted mb-4" th:text="${message}">인증 링크가 만료되었거나 올바르지 않습니다.</p>

            <!-- 인증 메일 다시 받기 버튼 -->
            <form id="resendForm" class="d-flex flex-column align-items-center">
                <input type="email" id="emailInput" class="form-control mb-3" placeholder="가입한 이메일 입력" required style="max-width: 300px;">
                <button type="submit" class="btn btn-dark w-100 fw-semibold" style="max-width: 300px;">인증 메일 다시 받기</button>
            </form>

            <p class="text-secondary small mt-3" id="resendMessage"></p>
        </div>
    </div>
</main>

<script>
    document.getElementById("resendForm")?.addEventListener("submit", async (e) => {
        e.preventDefault();
        const email = document.getElementById("emailInput").value.trim();
        const msg = document.getElementById("resendMessage");
        msg.textContent = "처리 중입니다...";

        try {
            const res = await fetch(`/api/members/resend-verification?email=${encodeURIComponent(email)}`, { method: "POST" });
            const data = await res.json();
            msg.textContent = data.message || "이메일 재발송 요청이 완료되었습니다.";
        } catch {
            msg.textContent = "오류가 발생했습니다. 다시 시도해주세요.";
        }
    });
</script>

<script th:inline="javascript">
    const success = /*[[${success}]]*/ false;
    const seconds = /*[[${redirectSeconds}]]*/ 0;
    if (success && seconds > 0) {
        setTimeout(() => { window.location.href = '/login'; }, seconds * 1000);
    }
</script>
</body>
</html>
